<script>

class GyroData {
    constructor(targetElement, orientationHandler) {
        this.targetElement = targetElement;
        this.oHandler = orientationHandler;
        //this.lastEvent;
        targetElement.addEventListener('click', this.onClick);
    }

    handleOrientation(event) {
        console.log('jw: handling gyro data class');
        // save reference to data object and dispatch event data
        this.lastEvent = event;
        dispatchEvent(event);
    }

    // initiate permission request for device gyro data access
    onClick() {
        try {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                // iOS 13+ devices
                DeviceMotionEvent.requestPermission()
                .then((state) => {
                    if (state === 'granted') {
                        console.log('this:',this)
                        console.log('oHandler:',oHandler)
                        window.addEventListener('devicemotion', oHandler);
                    } else {
                        console.error('Request to access the orientation was rejected');
                    }
                })
            } else {
                // Non iOS 13+ devices
                window.addEventListener('devicemotion', oHandler);
            }
        } catch (error) {
            // Handle desktop browsers
            console.error('DeviceMotion Events not supported in this browser');
            let event = new Event("NoDeviceMotion", {bubbles: true});
            dispatchEvent(event);
        }
    }
    
    // Getter
    get lastEvent() {
        return this.lastEvent;
    }
}



/*
    function handleOrientation(event) {
        // jw: destructuring here>?
        const alpha = event.rotationRate.alpha;
        const beta = event.rotationRate.beta;
        const gamma = event.rotationRate.gamma;
        console.log(event);
        //console.log(alpha, beta, gamma, '-----------');//TODO: //make this an event dispatcher
        btn.textContent = alpha+', '+beta+', '+gamma;


        // jw: let's just dispatch when running within class..
        dispatchEvent(event);


    }

    function onClick() {
        try {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                // iOS 13+ devices
                DeviceMotionEvent.requestPermission()
                .then((state) => {
                    if (state === 'granted') {
                        window.addEventListener('devicemotion', handleOrientation);
                    } else {
                        console.error('Request to access the orientation was rejected');
                    }
                })
            } else {
                // Non iOS 13+ devices
                window.addEventListener('devicemotion', handleOrientation);
            }
        } catch (error) {
            // Handle desktop browsers
            console.error('DeviceMotion Events not supported in this browser');
            let event = new Event("NoDeviceMotion", {bubbles: true});
            dispatchEvent(event);
        }
    }
*/

    document.addEventListener('DOMContentLoaded', () => {
        // Establish click handler for requesting access to the gyro data
        btn = document.getElementById('btn');
        //btn.addEventListener('click', onClick);
        const gyObj = new GyroData(btn, handleOrientation);
        // jw: listen to events now...

    });

    function handleOrientation(event) {
        // jw: destructuring here>?
        const alpha = event.rotationRate.alpha;
        const beta = event.rotationRate.beta;
        const gamma = event.rotationRate.gamma;
        console.log(event);
        //console.log(alpha, beta, gamma, '-----------');//TODO: //make this an event dispatcher
        btn.textContent = alpha+', '+beta+', '+gamma;


        // jw: let's just dispatch when running within class..
        dispatchEvent(event);


    }

    let btn;

</script>
<button id='btn' style="
    background-color:cornflowerblue; 
    width:100%; 
    height:100%;
    font-size:30px">
    Let's monitor that gyro data
</button>